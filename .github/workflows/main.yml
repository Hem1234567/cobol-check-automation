name: COBOL Check Automation

on:
  push:
    branches:
      - main

jobs:
  cobol-check:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Setup Java
      - name: Set up Java 11
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'

      # 3. Verify Java
      - name: Verify Java
        run: java -version

      # 4. Install Zowe CLI
      - name: Install Zowe CLI
        run: |
          npm install -g @zowe/cli
          zowe --version

      # 5. Upload COBOL Check to Mainframe (NO PROFILE)
      - name: Upload COBOL Check to Mainframe
        env:
          ZOWE_HOST: 204.90.115.200
          ZOWE_PORT: 10443
          ZOWE_USER: ${{ secrets.ZOWE_USERNAME }}
          ZOWE_PASSWORD: ${{ secrets.ZOWE_PASSWORD }}
          ZOWE_REJECT_UNAUTHORIZED: "true"
        run: |
          chmod +x .github/scripts/zowe_operations.sh
          .github/scripts/zowe_operations.sh

      # 6. Finish
      - name: Done
        run: echo "COBOL Check pipeline completed"
