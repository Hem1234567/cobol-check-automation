name: COBOL Check Automation

on:
  push:
    branches:
      - main

jobs:
  cobol-check:
    runs-on: ubuntu-latest

    steps:
      # -------------------------------
      # 1. Checkout Repository
      # -------------------------------
      - name: Checkout repository
        uses: actions/checkout@v3

      # -------------------------------
      # 2. Setup Java 11 (Required for COBOL Check)
      # -------------------------------
      - name: Set up Java 11
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'

      # -------------------------------
      # 3. Verify Java
      # -------------------------------
      - name: Verify Java
        run: java -version

      # -------------------------------
      # 4. Install Zowe CLI
      # -------------------------------
      - name: Install Zowe CLI
        run: |
          npm install -g @zowe/cli
          zowe --version

      # -------------------------------
      # 5. Upload COBOL Check to Mainframe
      # -------------------------------
      - name: Upload COBOL Check to Mainframe
        env:
          ZOWE_ZOSMF_HOST: 204.90.115.200
          ZOWE_ZOSMF_PORT: 10443
          ZOWE_ZOSMF_USER: ${{ secrets.ZOWE_USERNAME }}
          ZOWE_ZOSMF_PASSWORD: ${{ secrets.ZOWE_PASSWORD }}
          ZOWE_ZOSMF_REJECT_UNAUTHORIZED: "true"
        run: |
          chmod +x .github/scripts/zowe_operations.sh
          .github/scripts/zowe_operations.sh

      # -------------------------------
      # 6. Finish
      # -------------------------------
      - name: Done
        run: echo "COBOL Check GitHub Actions pipeline completed"
